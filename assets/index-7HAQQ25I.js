var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,i=(e,l,t)=>new Promise((a,r)=>{var o=e=>{try{i(t.next(e))}catch(l){r(l)}},s=e=>{try{i(t.throw(e))}catch(l){r(l)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,s);i((t=t.apply(e,l)).next())});import{d as n,D as m,x as u,a as d,S as p,o as c,e as j,f,h as v,p as x,z as b,I as y,u as h,G as _,H as g,y as w,aa as E,aY as V,l as O,m as k,aZ as P,aR as A,N as D,a_ as Y,aX as C}from"./index-CKM1fen8.js";import{E as I}from"./el-button-DoyUgqJB.js";import{a as M,E as U}from"./el-form-item-By2N_a5b.js";/* empty css                  *//* empty css                  *//* empty css                    */import{_ as z}from"./index.vue_vue_type_style_index_0_lang-BQibUpnb.js";import{E as N}from"./el-row-BcGmfk3v.js";/* empty css               */import{E as T,a as q}from"./el-option-DisnDj8j.js";/* empty css                  *//* empty css                     *//* empty css                  */import{E as B}from"./el-col-DogW5QcK.js";/* empty css                 */import{E as G}from"./emojo-Ben6gd8J.js";import{P as H}from"./formEnum-BLgiZVxV.js";import{E as S}from"./index-B7I_vG9C.js";import{E as R}from"./index-BN0pX-NP.js";import{E as W}from"./index-D_6TXvdw.js";import"./index-BM2-Y4df.js";import"./index-C0mez0sX.js";import"./use-form-common-props-DQZcihQX.js";import"./castArray-DlxkTWHs.js";import"./index-DmtduCk7.js";import"./_baseClone-DuY4jedt.js";import"./_initCloneObject-CLrXHQUW.js";import"./index-pB6x8TE-.js";import"./index-Ba5jcMC5.js";import"./aria-Dle50h-X.js";import"./index-DayQJJrD.js";import"./index-N7bjZI1X.js";import"./token-DWNpOE8r.js";import"./strings-CNX5bs_2.js";import"./event-BwRzfsZt.js";import"./scroll-d-m4ua5F.js";import"./debounce-DTnqz5uK.js";import"./toNumber-D96i-_vD.js";import"./_baseIteratee-DrESJfWH.js";import"./index-e96-4aEG.js";import"./vnode-BPtR4NST.js";import"./index-bQfTT8ye.js";import"./index-ChD8y9vR.js";import"./cloneDeep-B7zM8sPE.js";import"./validator-7CwAUGKe.js";const X={class:"max-w-250 mx-auto my-5"},Z={class:"p-5 mt-5 art-card-xs"},$={class:"mt-2.5"},F={key:0,class:"flex-cc flex-col w-65 h-40 border border-dashed border-[#d9d9d9] rounded-md"},J=["src"],K={class:"flex justify-end"},L=n((Q=((e,l)=>{for(var t in l||(l={}))r.call(l,t)&&s(e,t,l[t]);if(a)for(var t of a(l))o.call(l,t)&&s(e,t,l[t]);return e})({},{name:"ArticlePublish"}),l(Q,t({__name:"index",setup(e){const l=m(),t=u(),{accessToken:a}=t,r={Authorization:a},o=d(H.Add),s=d(""),n=d(),L=d([]),Q=d(""),ee=d(""),le=d(""),te=d(!0),ae=()=>i(null,null,function*(){try{const{data:e}=yield A.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.code===Y.success){const{title:l,blog_class:t,html_content:a}=e.data;s.value=l,n.value=Number(t),Q.value=a}}catch(e){D.error("获取文章详情失败")}}),re=e=>C(e,"YYYY-MM-DD").value,oe=()=>s.value.trim()?n.value?Q.value&&"<p><br></p>"!==Q.value?!!le.value||(D.error("请上传封面图片"),!1):(D.error("请输入文章内容"),!1):(D.error("请选择文章类型"),!1):(D.error("请输入文章标题"),!1),se=e=>e.replace(/(\s*)<\/code>/g,"</code>"),ie=()=>{o.value===H.Edit?i(null,null,function*(){if(oe())try{se(Q.value)}catch(e){D.error("保存文章失败")}}):i(null,null,function*(){if(oe())try{se(Q.value)}catch(e){D.error("发布文章失败")}})},ne=e=>{le.value=e.data.url,D.success(`图片上传成功 ${G[200]}`)},me=()=>{D.error(`图片上传失败 ${G[500]}`)},ue=e=>{const l=e.type.startsWith("image/"),t=e.size/1024/1024<2;return l?!!t||(D.error("图片大小不能超过 2MB"),!1):(D.error("只能上传图片文件"),!1)},{scrollToTop:de}=p();return c(()=>{de(),i(null,null,function*(){try{const{data:e}=yield A.get("https://www.qiniu.lingchen.kim/classify.json");200===e.code&&(L.value=e.data)}catch(e){D.error("获取文章分类失败")}}),(()=>{const{id:e}=l.query;o.value=e?H.Edit:H.Add,o.value===H.Edit?ae():ee.value=re(P().value)})()}),(e,l)=>{const t=S,a=B,i=q,m=T,u=N,d=z,p=E,c=R,P=M,A=W,D=U,Y=I;return f(),j("div",null,[v("div",null,[v("div",X,[x(u,{gutter:10},{default:b(()=>[x(a,{span:18},{default:b(()=>[x(t,{modelValue:h(s),"onUpdate:modelValue":l[0]||(l[0]=e=>y(s)?s.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])]),_:1}),x(a,{span:6},{default:b(()=>[x(m,{modelValue:h(n),"onUpdate:modelValue":l[1]||(l[1]=e=>y(n)?n.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:b(()=>[(f(!0),j(_,null,g(h(L),e=>(f(),w(i,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),x(d,{class:"mt-2.5",modelValue:h(Q),"onUpdate:modelValue":l[2]||(l[2]=e=>y(Q)?Q.value=e:null)},null,8,["modelValue"]),v("div",Z,[l[6]||(l[6]=v("h2",{class:"mb-5 text-xl font-medium"},"发布设置",-1)),x(D,null,{default:b(()=>[x(P,{label:"封面"},{default:b(()=>[v("div",$,[x(c,{action:"https://m1.apifoxmock.com/m1/6400575-6097373-default/api/common/upload",headers:r,"show-file-list":!1,"on-success":ne,"on-error":me,"before-upload":ue},{default:b(()=>[h(le)?(f(),j("img",{key:1,src:h(le),class:"block w-65 h-40 object-cover"},null,8,J)):(f(),j("div",F,[x(p,{class:"!text-xl !text-g-600"},{default:b(()=>[x(h(V))]),_:1}),l[4]||(l[4]=v("div",{class:"mt-2 text-sm text-g-600"},"点击上传封面",-1))]))]),_:1}),l[5]||(l[5]=v("div",{class:"mt-2 text-xs text-g-700"},"建议尺寸 16:9，jpg/png 格式",-1))])]),_:1}),x(P,{label:"可见"},{default:b(()=>[x(A,{modelValue:h(te),"onUpdate:modelValue":l[3]||(l[3]=e=>y(te)?te.value=e:null)},null,8,["modelValue"])]),_:1})]),_:1}),v("div",K,[x(Y,{type:"primary",onClick:ie,class:"w-25"},{default:b(()=>[O(k(h(o)===h(H).Edit?"保存":"发布"),1)]),_:1})])])])])])}}}))));var Q;export{L as default};
