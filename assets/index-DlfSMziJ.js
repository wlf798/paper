var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,r,l)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[r]=l,n=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&i(e,r,t[r]);if(l)for(var r of l(t))a.call(t,r)&&i(e,r,t[r]);return e},s=(e,t,r)=>new Promise((l,o)=>{var a=e=>{try{n(r.next(e))}catch(t){o(t)}},i=e=>{try{n(r.throw(e))}catch(t){o(t)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,i);n((r=r.apply(e,t)).next())});import{d as u,a as p,r as m,c as d,o as c,dP as v,F as j,e as h,f,p as y,u as b,I as g,z as _,J as x,y as k,l as w,m as C,aB as O,n as B,a8 as E,N as A}from"./index-DuNn1tT0.js";import{E as L}from"./el-card-DUwWYAzT.js";import{_ as P}from"./index-Bxa7FE6I.js";import{_ as M}from"./index-Bx35RROv.js";import{E as T}from"./el-button-Cu-8GITI.js";import{_ as I}from"./index-CMRHoB4e.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang-CQRBCumS.js";import{u as D}from"./useTableColumns-BUV2Ns1B.js";import{_ as $}from"./menu-dialog.vue_vue_type_script_setup_true_lang-BH1tUbK7.js";import"./tree-select-IgXI_18i.js";import{E as S}from"./overlay-kwvmBmBb.js";/* empty css              */import{E as V}from"./index-BHP5EuW7.js";import"./el-pagination-B_xTC7d1.js";import"./el-option-HDUlhA_A.js";import"./index-BICMxtfg.js";import"./index-CSnsSW2Y.js";import"./index-Cwozh5L4.js";import"./aria-Dle50h-X.js";import"./index-B54hCvU_.js";import"./use-form-common-props-YkJZMUeo.js";import"./index-DM4EDxAy.js";import"./token-DWNpOE8r.js";import"./strings-DrkoAcI2.js";import"./castArray-CK2YYBjI.js";import"./index-Qk1PgHVU.js";import"./index-DKGOt7-B.js";import"./event-BwRzfsZt.js";import"./index-I47MLRFf.js";import"./scroll-C6vSq5CK.js";import"./debounce-CaRH_5Ar.js";import"./toNumber-U8DKyFfl.js";import"./_baseIteratee-Bx0whLuV.js";import"./index-CaqOoRuI.js";import"./vnode-Cc9CZV6n.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-table-column-cPr1Gz0K.js";import"./_initCloneObject-DfdnlAFm.js";import"./isArrayLikeObject-BQVMs9dF.js";import"./raf-C1IIvJ8O.js";import"./index-Dwe9iiwQ.js";/* empty css                    *//* empty css                   */import"./el-empty-BdMhBNuP.js";import"./formEnum-BLgiZVxV.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-popover-DRNBfSaK.js";import"./el-dropdown-item-BJwlQklQ.js";import"./refs-Cw5r5QN8.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-D9lp4Hgf.js";import"./vue-draggable-plus-Cd_eMQgp.js";import"./el-form-item-DKoSTcyf.js";import"./_baseClone-lawoqp3c.js";import"./el-row-BI0QOwqJ.js";import"./el-col-D_v_uR8c.js";import"./el-radio-Dz0FMWKY.js";import"./index-CK0nxaeO.js";import"./index-RIOQcv3b.js";import"./index-CKiddVek.js";import"./validator-AtrFltAN.js";import"./index-CtnGaU-P.js";import"./el-dialog-C1U8d6Aq.js";import"./index-jtkC1QNG.js";import"./el-overlay-BJf7WO-c.js";import"./index-CS4yvE_C.js";/* empty css                       *//* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-CgjDC8EY.js";import"./cloneDeep-ZdKkb6OU.js";import"./clamp-CANCDev3.js";import"./index-_eAC2q0z.js";import"./index-BOVjSETM.js";const U={class:"menu-page art-full-height"},z=u((G=n({},{name:"Menus"}),t(G,r({__name:"index",setup(e){const t=p(!1),r=p(!1),l=p(),o=p(!1),a=p("menu"),i=p(null),u=p(!1),z={name:"",route:""},G=m(n({},z)),N=m(n({},z)),W=d(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"route",type:"input",props:{clearable:!0}}]);c(()=>{q()});const q=()=>s(null,null,function*(){t.value=!0;try{const e=yield v();X.value=e}catch(e){throw e instanceof Error?e:new Error("获取菜单失败")}finally{t.value=!1}}),F=e=>{var t,r,l,o,a;return(null==(t=e.meta)?void 0:t.isAuthButton)?"danger":(null==(r=e.children)?void 0:r.length)?"info":(null==(l=e.meta)?void 0:l.link)&&(null==(o=e.meta)?void 0:o.isIframe)?"success":e.path?"primary":(null==(a=e.meta)?void 0:a.link)?"warning":"info"},{columnChecks:J,columns:K}=D(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return O(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>E(V,{type:F(e)},()=>(e=>{var t,r,l,o,a;return(null==(t=e.meta)?void 0:t.isAuthButton)?"按钮":(null==(r=e.children)?void 0:r.length)?"目录":(null==(l=e.meta)?void 0:l.link)&&(null==(o=e.meta)?void 0:o.isIframe)?"内嵌":e.path?"菜单":(null==(a=e.meta)?void 0:a.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,r;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(r=e.meta)?void 0:r.link)||e.path||""}},{prop:"meta.authList",label:"权限标识",formatter:e=>{var t,r,l,o;return(null==(t=e.meta)?void 0:t.isAuthButton)?(null==(r=e.meta)?void 0:r.authMark)||"":(null==(o=null==(l=e.meta)?void 0:l.authList)?void 0:o.length)?`${e.meta.authList.length} 个权限标识`:""}},{prop:"date",label:"编辑时间",formatter:()=>"2022-3-12 12:00:00"},{prop:"status",label:"状态",formatter:()=>E(V,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{var t;const r={style:"text-align: right"};return(null==(t=e.meta)?void 0:t.isAuthButton)?E("div",r,[E(R,{type:"edit",onClick:()=>ie(e)}),E(R,{type:"delete",onClick:()=>ue()})]):E("div",r,[E(R,{type:"add",onClick:()=>oe(),title:"新增权限"}),E(R,{type:"edit",onClick:()=>ae(e)}),E(R,{type:"delete",onClick:()=>se()})])}}]),X=p([]),Y=()=>{Object.assign(G,n({},z)),Object.assign(N,n({},z)),q()},Z=()=>{Object.assign(N,n({},G)),q()},H=()=>{q()},Q=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(Array.isArray(e))return e.map(e=>Q(e));const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=Q(e[r]));return t},ee=e=>e.map(e=>{var t,r,l,o;const a=Q(e);if((null==(t=a.children)?void 0:t.length)&&(a.children=ee(a.children)),null==(l=null==(r=e.meta)?void 0:r.authList)?void 0:l.length){const t=e.meta.authList.map(t=>({path:`${e.path}_auth_${t.authMark}`,name:`${String(e.name)}_auth_${t.authMark}`,meta:{title:t.title,authMark:t.authMark,isAuthButton:!0,parentPath:e.path}}));a.children=(null==(o=a.children)?void 0:o.length)?[...a.children,...t]:t}return a}),te=e=>{var t,r,l,o;const a=[];for(const i of e){const e=(null==(t=N.name)?void 0:t.toLowerCase().trim())||"",n=(null==(r=N.route)?void 0:r.toLowerCase().trim())||"",s=O((null==(l=i.meta)?void 0:l.title)||"").toLowerCase(),u=(i.path||"").toLowerCase(),p=!e||s.includes(e),m=!n||u.includes(n);if(null==(o=i.children)?void 0:o.length){const e=te(i.children);if(e.length>0){const t=Q(i);t.children=e,a.push(t);continue}}p&&m&&a.push(Q(i))}return a},re=d(()=>{const e=te(X.value);return ee(e)}),le=()=>{a.value="menu",i.value=null,u.value=!0,o.value=!0},oe=()=>{a.value="menu",i.value=null,u.value=!1,o.value=!0},ae=e=>{a.value="menu",i.value=e,u.value=!0,o.value=!0},ie=e=>{var t,r;a.value="button",i.value={title:null==(t=e.meta)?void 0:t.title,authMark:null==(r=e.meta)?void 0:r.authMark},u.value=!1,o.value=!0},ne=e=>{q()},se=()=>s(null,null,function*(){try{yield S.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),A.success("删除成功"),q()}catch(e){"cancel"!==e&&A.error("删除失败")}}),ue=()=>s(null,null,function*(){try{yield S.confirm("确定要删除该权限吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),A.success("删除成功"),q()}catch(e){"cancel"!==e&&A.error("删除失败")}}),pe=()=>{r.value=!r.value,B(()=>{var e;if((null==(e=l.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var o;(null==(o=t.children)?void 0:o.length)&&(l.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})};return(e,n)=>{const s=I,p=T,m=M,d=P,c=L,v=j("auth"),O=j("ripple");return f(),h("div",U,[y(s,{modelValue:b(G),"onUpdate:modelValue":n[0]||(n[0]=e=>g(G)?G.value=e:null),items:b(W),showExpand:!1,onReset:Y,onSearch:Z},null,8,["modelValue","items"]),y(c,{class:"art-table-card",shadow:"never"},{default:_(()=>[y(m,{showZebra:!1,loading:b(t),columns:b(J),"onUpdate:columns":n[1]||(n[1]=e=>g(J)?J.value=e:null),onRefresh:H},{left:_(()=>[x((f(),k(p,{onClick:le},{default:_(()=>[...n[3]||(n[3]=[w(" 添加菜单 ",-1)])]),_:1})),[[v,"add"],[O]]),x((f(),k(p,{onClick:pe},{default:_(()=>[w(C(b(r)?"收起":"展开"),1)]),_:1})),[[O]])]),_:1},8,["loading","columns"]),y(d,{ref_key:"tableRef",ref:l,rowKey:"path",loading:b(t),columns:b(K),data:b(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),y($,{visible:b(o),"onUpdate:visible":n[2]||(n[2]=e=>g(o)?o.value=e:null),type:b(a),editData:b(i),lockType:b(u),onSubmit:ne},null,8,["visible","type","editData","lockType"])]),_:1})])}}}))));var G;export{z as default};
