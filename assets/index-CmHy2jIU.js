var e=Object.defineProperty,a=Object.defineProperties,s=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(a,s,t)=>s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,i=(e,a)=>{for(var s in a||(a={}))l.call(a,s)&&n(e,s,a[s]);if(t)for(var s of t(a))o.call(a,s)&&n(e,s,a[s]);return e},r=(e,t)=>a(e,s(t));import{cc as c,aS as u,a1 as d,aj as v,al as f,_ as p,d as m,cA as g,cL as b,cM as y,bf as w,W as k,bX as h,a as x,cN as O,c as I,cG as z,aw as C,w as S,o as _,bt as N,y as $,f as P,z as E,p as j,Y as L,h as T,g as R,i as A,u as B,k as Y,e as M,j as X,az as D,aa as F,c1 as V,G as W,aC as G,a4 as q,l as H,m as K,cO as U,cP as Z,at as Q,cQ as J,cR as ee,cS as ae,U as se,V as te,n as le,ao as oe,bu as ne,bW as ie,bk as re,ae as ce,X as ue,bC as de,bp as ve,bB as fe,bV as pe,a9 as me,cT as ge,cU as be,cV as ye}from"./index-DuNn1tT0.js";import{E as we,a as ke}from"./index-Cwozh5L4.js";import{d as he}from"./debounce-CaRH_5Ar.js";import{u as xe}from"./index-I47MLRFf.js";import{a as Oe}from"./scroll-C6vSq5CK.js";function Ie(e,a,s){var t=!0,l=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return c(s)&&(t="leading"in s?!!s.leading:t,l="trailing"in s?!!s.trailing:l),he(e,a,{leading:t,maxWait:a,trailing:l})}const ze=d({urlList:{type:v(Array),default:()=>f([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:v(String)}}),Ce={close:()=>!0,error:e=>e instanceof Event,switch:e=>u(e),rotate:e=>u(e)},Se=m({name:"ElImageViewer"});const _e=oe(p(m(r(i({},Se),{props:ze,emits:Ce,setup(e,{expose:a,emit:s}){var t;const l=e,o={CONTAIN:{name:"contain",icon:g(y)},ORIGINAL:{name:"original",icon:g(b)}};let n,c="";const{t:u}=w(),d=k("image-viewer"),{nextZIndex:v}=h(),f=x(),p=x(),m=O(),oe=I(()=>{const{scale:e,minScale:a,maxScale:s}=l;return z(e,a,s)}),ne=x(!0),ie=x(!1),re=x(l.initialIndex),ce=C(o.CONTAIN),ue=x({scale:oe.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),de=x(null!=(t=l.zIndex)?t:v()),ve=I(()=>{const{urlList:e}=l;return e.length<=1}),fe=I(()=>0===re.value),pe=I(()=>re.value===l.urlList.length-1),me=I(()=>l.urlList[re.value]),ge=I(()=>[d.e("btn"),d.e("prev"),d.is("disabled",!l.infinite&&fe.value)]),be=I(()=>[d.e("btn"),d.e("next"),d.is("disabled",!l.infinite&&pe.value)]),ye=I(()=>{const{scale:e,deg:a,offsetX:s,offsetY:t,enableTransition:l}=ue.value;let n=s/e,i=t/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);n=n*c+i*u,i=i*c-s/e*u;const d={transform:`scale(${e}) rotate(${a}deg) translate(${n}px, ${i}px)`,transition:l?"transform .3s":""};return ce.value.name===o.CONTAIN.name&&(d.maxWidth=d.maxHeight="100%"),d}),he=I(()=>`${re.value+1} / ${l.urlList.length}`);function xe(){m.stop(),null==n||n(),document.body.style.overflow=c,s("close")}function Oe(){ne.value=!1}function ze(e){ie.value=!0,ne.value=!1,s("error",e),e.target.alt=u("el.image.error")}function Ce(e){if(ne.value||0!==e.button||!f.value)return;ue.value.enableTransition=!1;const{offsetX:a,offsetY:s}=ue.value,t=e.pageX,l=e.pageY,o=Ie(e=>{ue.value=r(i({},ue.value),{offsetX:a+e.pageX-t,offsetY:s+e.pageY-l})}),n=N(document,"mousemove",o);N(document,"mouseup",()=>{n()}),e.preventDefault()}function Se(){ue.value={scale:oe.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function _e(){if(ne.value||ie.value)return;const e=ae(o),a=Object.values(o),s=ce.value.name,t=(a.findIndex(e=>e.name===s)+1)%e.length;ce.value=o[e[t]],Se()}function Ne(e){ie.value=!1;const a=l.urlList.length;re.value=(e+a)%a}function $e(){fe.value&&!l.infinite||Ne(re.value-1)}function Pe(){pe.value&&!l.infinite||Ne(re.value+1)}function Ee(e,a={}){if(ne.value||ie.value)return;const{minScale:t,maxScale:o}=l,{zoomRate:n,rotateDeg:r,enableTransition:c}=i({zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0},a);switch(e){case"zoomOut":ue.value.scale>t&&(ue.value.scale=Number.parseFloat((ue.value.scale/n).toFixed(3)));break;case"zoomIn":ue.value.scale<o&&(ue.value.scale=Number.parseFloat((ue.value.scale*n).toFixed(3)));break;case"clockwise":ue.value.deg+=r,s("rotate",ue.value.deg);break;case"anticlockwise":ue.value.deg-=r,s("rotate",ue.value.deg)}ue.value.enableTransition=c}function je(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Le(){l.closeOnPressEscape&&xe()}function Te(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return S(()=>oe.value,e=>{ue.value.scale=e}),S(me,()=>{le(()=>{const e=p.value;(null==e?void 0:e.complete)||(ne.value=!0)})}),S(re,e=>{Se(),s("switch",e)}),_(()=>{!function(){const e=Ie(e=>{switch(se(e)){case te.esc:l.closeOnPressEscape&&xe();break;case te.space:_e();break;case te.left:$e();break;case te.up:Ee("zoomIn");break;case te.right:Pe();break;case te.down:Ee("zoomOut")}}),a=Ie(e=>{Ee((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});m.run(()=>{N(document,"keydown",e),N(document,"wheel",a)})}(),n=N("wheel",Te,{passive:!1}),c=document.body.style.overflow,document.body.style.overflow="hidden"}),a({setActiveItem:Ne}),(e,a)=>(P(),$(B(ke),{to:"body",disabled:!e.teleported},{default:E(()=>[j(L,{name:"viewer-fade",appear:""},{default:E(()=>[T("div",{ref_key:"wrapper",ref:f,tabindex:-1,class:A(B(d).e("wrapper")),style:R({zIndex:de.value})},[j(B(we),{loop:"",trapped:"","focus-trap-el":f.value,"focus-start-el":"container",onFocusoutPrevented:je,onReleaseRequested:Le},{default:E(()=>[T("div",{class:A(B(d).e("mask")),onClick:D(a=>e.hideOnClickModal&&xe(),["self"])},null,10,["onClick"]),Y(" CLOSE "),T("span",{class:A([B(d).e("btn"),B(d).e("close")]),onClick:xe},[j(B(F),null,{default:E(()=>[j(B(V))]),_:1})],2),Y(" ARROW "),B(ve)?Y("v-if",!0):(P(),M(W,{key:0},[T("span",{class:A(B(ge)),onClick:$e},[j(B(F),null,{default:E(()=>[j(B(G))]),_:1})],2),T("span",{class:A(B(be)),onClick:Pe},[j(B(F),null,{default:E(()=>[j(B(q))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(P(),M("div",{key:1,class:A([B(d).e("btn"),B(d).e("progress")])},[X(e.$slots,"progress",{activeIndex:re.value,total:e.urlList.length},()=>[H(K(B(he)),1)])],2)):Y("v-if",!0),Y(" ACTIONS "),T("div",{class:A([B(d).e("btn"),B(d).e("actions")])},[T("div",{class:A(B(d).e("actions__inner"))},[X(e.$slots,"toolbar",{actions:Ee,prev:$e,next:Pe,reset:_e,activeIndex:re.value,setActiveItem:Ne},()=>[j(B(F),{onClick:e=>Ee("zoomOut")},{default:E(()=>[j(B(U))]),_:1},8,["onClick"]),j(B(F),{onClick:e=>Ee("zoomIn")},{default:E(()=>[j(B(Z))]),_:1},8,["onClick"]),T("i",{class:A(B(d).e("actions__divider"))},null,2),j(B(F),{onClick:_e},{default:E(()=>[(P(),$(Q(B(ce).icon)))]),_:1}),T("i",{class:A(B(d).e("actions__divider"))},null,2),j(B(F),{onClick:e=>Ee("anticlockwise")},{default:E(()=>[j(B(J))]),_:1},8,["onClick"]),j(B(F),{onClick:e=>Ee("clockwise")},{default:E(()=>[j(B(ee))]),_:1},8,["onClick"])])],2)],2),Y(" CANVAS "),T("div",{class:A(B(d).e("canvas"))},[ie.value&&e.$slots["viewer-error"]?X(e.$slots,"viewer-error",{key:0,activeIndex:re.value,src:B(me)}):(P(),M("img",{ref_key:"imgRef",ref:p,key:B(me),src:B(me),style:R(B(ye)),class:A(B(d).e("img")),crossorigin:e.crossorigin,onLoad:Oe,onError:ze,onMousedown:Ce},null,46,["src","crossorigin"]))],2),X(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}})),[["__file","image-viewer.vue"]])),Ne=d({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:v([String,Object])},previewSrcList:{type:v(Array),default:()=>f([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:v(String)}}),$e={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>u(e),close:()=>!0,show:()=>!0},Pe=m({name:"ElImage",inheritAttrs:!1});const Ee=oe(p(m(r(i({},Pe),{props:Ne,emits:$e,setup(e,{expose:a,emit:s}){const t=e,{t:l}=w(),o=k("image"),n=ne(),i=I(()=>ie(Object.entries(n).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),r=xe({excludeListeners:!0,excludeKeys:I(()=>Object.keys(i.value))}),c=x(),u=x(!1),d=x(!0),v=x(!1),f=x(),p=x(),m=re&&"loading"in HTMLImageElement.prototype;let g;const b=I(()=>[o.e("inner"),h.value&&o.e("preview"),d.value&&o.is("loading")]),y=I(()=>{const{fit:e}=t;return re&&e?{objectFit:e}:{}}),h=I(()=>{const{previewSrcList:e}=t;return ce(e)&&e.length>0}),O=I(()=>{const{previewSrcList:e,initialIndex:a}=t;let s=a;return a>e.length-1&&(s=0),s}),z=I(()=>"eager"!==t.loading&&(!m&&"lazy"===t.loading||t.lazy)),C=()=>{re&&(d.value=!0,u.value=!1,c.value=t.src)};function N(e){d.value=!1,u.value=!1,s("load",e)}function j(e){d.value=!1,u.value=!0,s("error",e)}const L=ye(function(e){e&&(C(),D())},200,!0);function R(){return e=this,a=null,s=function*(){var e;if(!re)return;yield le();const{scrollContainer:a}=t;if(pe(a))p.value=a;else if(me(a)&&""!==a)p.value=null!=(e=document.querySelector(a))?e:void 0;else if(f.value){const e=Oe(f.value);p.value=ge(e)?void 0:e}const{stop:s}=be(f,([e])=>{L(e.isIntersecting)},{root:p});g=s},new Promise((t,l)=>{var o=e=>{try{i(s.next(e))}catch(a){l(a)}},n=e=>{try{i(s.throw(e))}catch(a){l(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,a)).next())});var e,a,s}function D(){re&&L&&(null==g||g(),p.value=void 0,g=void 0)}function F(){h.value&&(v.value=!0,s("show"))}function V(){v.value=!1,s("close")}function G(e){s("switch",e)}return S(()=>t.src,()=>{z.value?(d.value=!0,u.value=!1,D(),R()):C()}),_(()=>{z.value?R():C()}),a({showPreview:F}),(e,a)=>(P(),M("div",ue({ref_key:"container",ref:f},B(i),{class:[B(o).b(),e.$attrs.class]}),[u.value?X(e.$slots,"error",{key:0},()=>[T("div",{class:A(B(o).e("error"))},K(B(l)("el.image.error")),3)]):(P(),M(W,{key:1},[void 0!==c.value?(P(),M("img",ue({key:0},B(r),{src:c.value,loading:e.loading,style:B(y),class:B(b),crossorigin:e.crossorigin,onClick:F,onLoad:N,onError:j}),null,16,["src","loading","crossorigin"])):Y("v-if",!0),d.value?(P(),M("div",{key:1,class:A(B(o).e("wrapper"))},[X(e.$slots,"placeholder",{},()=>[T("div",{class:A(B(o).e("placeholder"))},null,2)])],2)):Y("v-if",!0)],64)),B(h)?(P(),M(W,{key:2},[v.value?(P(),$(B(_e),{key:0,"z-index":e.zIndex,"initial-index":B(O),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"show-progress":e.showProgress,"url-list":e.previewSrcList,scale:e.scale,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:V,onSwitch:G},de({toolbar:E(a=>[X(e.$slots,"toolbar",ve(fe(a)))]),default:E(()=>[e.$slots.viewer?(P(),M("div",{key:0},[X(e.$slots,"viewer")])):Y("v-if",!0)]),_:2},[e.$slots.progress?{name:"progress",fn:E(a=>[X(e.$slots,"progress",ve(fe(a)))])}:void 0,e.$slots["viewer-error"]?{name:"viewer-error",fn:E(a=>[X(e.$slots,"viewer-error",ve(fe(a)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):Y("v-if",!0)],64)):Y("v-if",!0)],16))}})),[["__file","image.vue"]]));export{Ee as E};
