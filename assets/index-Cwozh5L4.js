var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))s.call(t,n)&&a(e,n,t[n]);return e},c=(e,o)=>t(e,n(o));import{f as d}from"./aria-Dle50h-X.js";import{o as l,b as i,a as f,bk as p,U as v,V as m,_ as E,d as y,j as b,w,u as h,ah as L,n as T,a9 as P,a6 as g,a1 as O,aj as j,y as k,f as F,ax as R,ao as S}from"./index-DuNn1tT0.js";const _="focus-trap.focus-after-trapped",K="focus-trap.focus-after-released",N={cancelable:!0,bubbles:!1},I={cancelable:!0,bubbles:!1},x="focusAfterTrapped",C="focusAfterReleased",A=Symbol("elFocusTrap"),D=f(),q=f(0),B=f(0);let U=0;const $=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},H=(e,t)=>{for(const n of e)if(!M(n,t))return n},M=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},W=(e,t)=>{if(e){const n=document.activeElement;d(e,{preventScroll:!0}),B.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function V(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const z=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=V(e,t),e.unshift(t)},remove:t=>{var n,o;e=V(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),G=()=>{D.value="pointer",q.value=window.performance.now()},J=()=>{D.value="keyboard",q.value=window.performance.now()},Q=e=>new CustomEvent("focus-trap.focusout-prevented",c(u({},I),{detail:e}));let X=[];const Y=e=>{v(e)===m.esc&&X.forEach(t=>t(e))};var Z=E(y({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[x,C,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=f();let o,r;const{focusReason:s}=(l(()=>{0===U&&(document.addEventListener("mousedown",G),document.addEventListener("touchstart",G),document.addEventListener("keydown",J)),U++}),i(()=>{U--,U<=0&&(document.removeEventListener("mousedown",G),document.removeEventListener("touchstart",G),document.removeEventListener("keydown",J))}),{focusReason:D,lastUserFocusTimestamp:q,lastAutomatedFocusTimestamp:B});var a;a=n=>{e.trapped&&!d.paused&&t("release-requested",n)},l(()=>{0===X.length&&document.addEventListener("keydown",Y),p&&X.push(a)}),i(()=>{X=X.filter(e=>e!==a),0===X.length&&p&&document.removeEventListener("keydown",Y)});const d={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},E=n=>{if(!e.loop&&!e.trapped)return;if(d.paused)return;const{altKey:o,ctrlKey:r,metaKey:a,currentTarget:u,shiftKey:c}=n,{loop:l}=e,i=v(n)===m.tab&&!o&&!r&&!a,f=document.activeElement;if(i&&f){const e=u,[o,r]=(e=>{const t=$(e);return[H(t,e),H(t.reverse(),e)]})(e);if(o&&r)if(c||f!==r){if(c&&[o,e].includes(f)){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),l&&W(r,!0))}}else{const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),l&&W(o,!0))}else if(f===e){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||n.preventDefault()}}};g(A,{focusTrapRef:n,onKeydown:E}),w(()=>e.focusTrapEl,e=>{e&&(n.value=e)},{immediate:!0}),w([n],([e],[t])=>{e&&(e.addEventListener("keydown",E),e.addEventListener("focusin",O),e.addEventListener("focusout",j)),t&&(t.removeEventListener("keydown",E),t.removeEventListener("focusin",O),t.removeEventListener("focusout",j))});const y=e=>{t(x,e)},b=e=>t(C,e),O=s=>{const a=h(n);if(!a)return;const u=s.target,c=s.relatedTarget,l=u&&a.contains(u);if(!e.trapped){c&&a.contains(c)||(o=c)}l&&t("focusin",s),d.paused||e.trapped&&(l?r=u:W(r,!0))},j=o=>{const a=h(n);if(!d.paused&&a)if(e.trapped){const n=o.relatedTarget;L(n)||a.contains(n)||setTimeout(()=>{if(!d.paused&&e.trapped){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||W(r,!0)}},0)}else{const e=o.target;e&&a.contains(e)||t("focusout",o)}};function k(){return t=this,r=null,s=function*(){yield T();const t=h(n);if(t){z.push(d);const n=t.contains(document.activeElement)?o:document.activeElement;if(o=n,!t.contains(n)){const o=new Event(_,N);t.addEventListener(_,y),t.dispatchEvent(o),o.defaultPrevented||T(()=>{let o=e.focusStartEl;P(o)||(W(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(W(o,t),document.activeElement!==n)return})($(t),!0),document.activeElement!==n&&"container"!==o||W(t)})}}},new Promise((e,n)=>{var o=e=>{try{u(s.next(e))}catch(t){n(t)}},a=e=>{try{u(s.throw(e))}catch(t){n(t)}},u=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);u((s=s.apply(t,r)).next())});var t,r,s}function F(){const e=h(n);if(e){e.removeEventListener(_,y);const t=new CustomEvent(K,c(u({},N),{detail:{focusReason:s.value}}));e.addEventListener(K,b),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=s.value&&q.value>B.value&&!e.contains(document.activeElement)||W(null!=o?o:document.body),e.removeEventListener(K,b),z.remove(d),o=null,r=null}}return l(()=>{e.trapped&&k(),w(()=>e.trapped,e=>{e?k():F()})}),i(()=>{e.trapped&&F(),n.value&&(n.value.removeEventListener("keydown",E),n.value.removeEventListener("focusin",O),n.value.removeEventListener("focusout",j),n.value=void 0)}),{onKeydown:E}}}),[["render",function(e,t,n,o,r,s){return b(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const ee=O({to:{type:j([String,Object]),required:!0},disabled:Boolean});const te=S(E(y({__name:"teleport",props:ee,setup:e=>(e,t)=>e.disabled?b(e.$slots,"default",{key:0}):(F(),k(R,{key:1,to:e.to},[b(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{Z as E,A as F,te as a,ee as t};
