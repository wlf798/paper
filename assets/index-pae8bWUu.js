var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},i=(e,a)=>t(e,n(a));import{a1 as s,aj as c,ae as f,_ as v,d,c as m,aw as p,a as g,o as h,w as x,b,bn as y,e as $,f as w,j as M,g as A,a5 as E,ao as j}from"./index-CKM1fen8.js";const B=s({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:c([String,Array]),default:"Element Plus"},font:{type:c(Object)},gap:{type:c(Array),default:()=>[100,100]},offset:{type:c(Array)}});const I={left:[0,.5],start:[0,.5],center:[.5,0],right:[1,-.5],end:[1,-.5]};function O(e,t,n=1){const a=document.createElement("canvas"),r=a.getContext("2d"),o=e*n,l=t*n;return a.setAttribute("width",`${o}px`),a.setAttribute("height",`${l}px`),r.save(),[r,a,o,l]}function P(){return function(e,t,n,a,r,o,l,u,i){const[s,c,v,d]=O(a,r,n);if(e instanceof HTMLImageElement)s.drawImage(e,0,0,v,d);else{const{color:t,fontSize:a,fontStyle:l,fontWeight:u,fontFamily:c,textAlign:d,textBaseline:m}=o,p=Number(a)*n;s.font=`${l} normal ${u} ${p}px/${r}px ${c}`,s.fillStyle=t,s.textAlign=d,s.textBaseline=m;const g=f(e)?e:[e];null==g||g.forEach((e,t)=>{const[a,r]=I[d];s.fillText(null!=e?e:"",v*a+i*r,t*(p+3*n))})}const m=Math.PI/180*Number(t),p=Math.max(a,r),[g,h,x]=O(p,p,n);g.translate(x/2,x/2),g.rotate(m),v>0&&d>0&&g.drawImage(c,-v/2,-d/2);let b=0,y=0,$=0,w=0;const M=v/2,A=d/2;[[0-M,0-A],[0+M,0-A],[0+M,0+A],[0-M,0+A]].forEach(([e,t])=>{const[n,a]=function(e,t){return[e*Math.cos(m)-t*Math.sin(m),e*Math.sin(m)+t*Math.cos(m)]}(e,t);b=Math.min(b,n),y=Math.max(y,n),$=Math.min($,a),w=Math.max(w,a)});const E=b+x/2,j=$+x/2,B=y-b,P=w-$,S=l*n,N=u*n,k=2*(B+S),z=P+N,[T,D]=O(k,z);function L(e=0,t=0){T.drawImage(h,E,j,B,P,e,t,B,P)}return L(),L(B+S,-P/2-N/2),L(B+S,+P/2+N/2),[D.toDataURL(),k/n,z/n]}}const S=d({name:"ElWatermark"});const N=j(v(d(i(u({},S),{props:B,setup(e){const t=e,n={position:"relative"},a=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.color)?n:"rgba(0,0,0,.15)"}),r=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontSize)?n:16}),o=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontWeight)?n:"normal"}),l=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontStyle)?n:"normal"}),s=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.fontFamily)?n:"sans-serif"}),c=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.textAlign)?n:"center"}),v=m(()=>{var e,n;return null!=(n=null==(e=t.font)?void 0:e.textBaseline)?n:"hanging"}),d=m(()=>t.gap[0]),j=m(()=>t.gap[1]),B=m(()=>d.value/2),I=m(()=>j.value/2),O=m(()=>{var e,n;return null!=(n=null==(e=t.offset)?void 0:e[0])?n:B.value}),S=m(()=>{var e,n;return null!=(n=null==(e=t.offset)?void 0:e[1])?n:I.value}),N=p(null),k=p(),z=g(!1),T=()=>{k.value&&(k.value.remove(),k.value=void 0)},D=(e,n)=>{var a;N.value&&k.value&&(z.value=!0,k.value.setAttribute("style",function(e){return Object.keys(e).map(t=>`${function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}(t)}: ${e[t]};`).join(" ")}(i(u({},(()=>{const e={zIndex:t.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let n=O.value-B.value,a=S.value-I.value;return n>0&&(e.left=`${n}px`,e.width=`calc(100% - ${n}px)`,n=0),a>0&&(e.top=`${a}px`,e.height=`calc(100% - ${a}px)`,a=0),e.backgroundPosition=`${n}px ${a}px`,e})()),{backgroundImage:`url('${e}')`,backgroundSize:`${Math.floor(n)}px`}))),null==(a=N.value)||a.append(k.value),setTimeout(()=>{z.value=!1}))},L=P(),R=()=>{const e=document.createElement("canvas").getContext("2d"),n=t.image,u=t.content,i=t.rotate;if(e){k.value||(k.value=document.createElement("div"));const m=window.devicePixelRatio||1,[p,g,h]=(e=>{let n=120,a=64,o=0;const{image:l,content:u,width:i,height:c,rotate:v}=t;if(!l&&e.measureText){e.font=`${Number(r.value)}px ${s.value}`;const t=f(u)?u:[u];let l=0,i=0;t.forEach(t=>{const{width:n,fontBoundingBoxAscent:a,fontBoundingBoxDescent:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u}=e.measureText(t),s=E(a)?o+u:a+r;n>l&&(l=Math.ceil(n)),s>i&&(i=Math.ceil(s))}),n=l,a=i*t.length+3*(t.length-1);const c=Math.PI/180*Number(v);o=Math.ceil(Math.abs(Math.sin(c)*a)/2),n+=o}return[null!=i?i:n,null!=c?c:a,o]})(e),x=e=>{const[t,n]=L(e||"",i,m,p,g,{color:a.value,fontSize:r.value,fontStyle:l.value,fontWeight:o.value,fontFamily:s.value,textAlign:c.value,textBaseline:v.value},d.value,j.value,h);D(t,n)};if(n){const e=new Image;e.onload=()=>{x(e)},e.onerror=()=>{x(u)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=n}else x(u)}};h(()=>{R()}),x(()=>t,()=>{R()},{deep:!0,flush:"post"}),b(()=>{T()});return y(N,e=>{z.value||e.forEach(e=>{((e,t)=>{let n=!1;return e.removedNodes.length&&t&&(n=Array.from(e.removedNodes).includes(t)),"attributes"===e.type&&e.target===t&&(n=!0),n})(e,k.value)&&(T(),R())})},{attributes:!0,subtree:!0,childList:!0}),(e,t)=>(w(),$("div",{ref_key:"containerRef",ref:N,style:A([n])},[M(e.$slots,"default")],4))}})),[["__file","watermark.vue"]]));export{N as E};
